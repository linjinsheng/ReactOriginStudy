{"ast":null,"code":"import _classCallCheck from \"/Users/linjinsheng/Desktop/ReactOriginStudy/\\u7B2C01\\u7AE0 \\u7406\\u5FF5\\u7BC7/1.1 \\u5982\\u4F55\\u5B66\\u4E60React\\u6E90\\u7801/concurrent/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/linjinsheng/Desktop/ReactOriginStudy/\\u7B2C01\\u7AE0 \\u7406\\u5FF5\\u7BC7/1.1 \\u5982\\u4F55\\u5B66\\u4E60React\\u6E90\\u7801/concurrent/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/linjinsheng/Desktop/ReactOriginStudy/\\u7B2C01\\u7AE0 \\u7406\\u5FF5\\u7BC7/1.1 \\u5982\\u4F55\\u5B66\\u4E60React\\u6E90\\u7801/concurrent/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/linjinsheng/Desktop/ReactOriginStudy/\\u7B2C01\\u7AE0 \\u7406\\u5FF5\\u7BC7/1.1 \\u5982\\u4F55\\u5B66\\u4E60React\\u6E90\\u7801/concurrent/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/linjinsheng/Desktop/ReactOriginStudy/\\u7B2C01\\u7AE0 \\u7406\\u5FF5\\u7BC7/1.1 \\u5982\\u4F55\\u5B66\\u4E60React\\u6E90\\u7801/concurrent/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/linjinsheng/Desktop/ReactOriginStudy/\\u7B2C01\\u7AE0 \\u7406\\u5FF5\\u7BC7/1.1 \\u5982\\u4F55\\u5B66\\u4E60React\\u6E90\\u7801/concurrent/src/Clock.js\";\nimport React from \"react\";\nvar ConcurrentMode = React.unstable_ConcurrentMode,\n    Component = React.Component,\n    Suspense = React.Suspense,\n    PureComponent = React.PureComponent,\n    createRef = React.createRef;\nvar SPEED = 0.003 / Math.PI;\nvar FRAMES = 10;\n\nvar Clock = /*#__PURE__*/function (_PureComponent) {\n  _inherits(Clock, _PureComponent);\n\n  function Clock() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, Clock);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(Clock)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.faceRef = createRef();\n    _this.arcGroupRef = createRef();\n    _this.clockHandRef = createRef();\n    _this.frame = null;\n    _this.hitCounter = 0;\n    _this.rotation = 0;\n    _this.t0 = Date.now();\n    _this.arcs = [];\n\n    _this.animate = function () {\n      var now = Date.now();\n      var td = now - _this.t0;\n      _this.rotation = (_this.rotation + SPEED * td) % (2 * Math.PI);\n      _this.t0 = now;\n\n      _this.arcs.push({\n        rotation: _this.rotation,\n        td: td\n      });\n\n      var lx, ly, tx, ty;\n\n      if (_this.arcs.length > FRAMES) {\n        _this.arcs.forEach(function (_ref, i) {\n          var rotation = _ref.rotation,\n              td = _ref.td;\n          lx = tx;\n          ly = ty;\n          var r = 145;\n          tx = 155 + r * Math.cos(rotation);\n          ty = 155 + r * Math.sin(rotation);\n          var bigArc = SPEED * td < Math.PI ? \"0\" : \"1\";\n          var path = \"M\".concat(tx, \" \").concat(ty, \"A\").concat(r, \" \").concat(r, \" 0 \").concat(bigArc, \" 0 \").concat(lx, \" \").concat(ly, \"L155 155\");\n          var hue = 120 - Math.min(120, td / 4);\n          var colour = \"hsl(\".concat(hue, \", 100%, \").concat(60 - i * (30 / FRAMES), \"%)\");\n\n          if (i !== 0) {\n            var arcEl = _this.arcGroupRef.current.children[i - 1];\n            arcEl.setAttribute(\"d\", path);\n            arcEl.setAttribute(\"fill\", colour);\n          }\n        });\n\n        _this.clockHandRef.current.setAttribute(\"d\", \"M155 155L\".concat(tx, \" \").concat(ty));\n\n        _this.arcs.shift();\n      }\n\n      if (_this.hitCounter > 0) {\n        _this.faceRef.current.setAttribute(\"fill\", \"hsla(0, 0%, \".concat(_this.hitCounter, \"%, 0.95)\"));\n\n        _this.hitCounter -= 1;\n      } else {\n        _this.hitCounter = 0;\n\n        _this.faceRef.current.setAttribute(\"fill\", \"hsla(0, 0%, 5%, 0.95)\");\n      }\n\n      _this.frame = requestAnimationFrame(_this.animate);\n    };\n\n    _this.handleClick = function (e) {\n      e.stopPropagation();\n      _this.hitCounter = 50;\n    };\n\n    return _this;\n  }\n\n  _createClass(Clock, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.frame = requestAnimationFrame(this.animate);\n\n      if (this.faceRef.current) {\n        this.faceRef.current.addEventListener(\"click\", this.handleClick);\n      }\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate() {\n      console.log(\"componentDidUpdate()\", this.faceRef.current);\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.faceRef.current.removeEventListener(\"click\", this.handleClick);\n\n      if (this.frame) {\n        cancelAnimationFrame(this.frame);\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var paths = new Array(FRAMES);\n\n      for (var i = 0; i < FRAMES; i++) {\n        paths.push( /*#__PURE__*/React.createElement(\"path\", {\n          className: \"arcHand\",\n          key: i,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 94,\n            columnNumber: 18\n          }\n        }));\n      }\n\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"stutterer\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 97,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"svg\", {\n        height: \"310\",\n        width: \"310\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 98,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"circle\", {\n        className: \"clockFace\",\n        onClick: this.handleClick,\n        cx: 155,\n        cy: 155,\n        r: 150,\n        ref: this.faceRef,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 99,\n          columnNumber: 11\n        }\n      }), /*#__PURE__*/React.createElement(\"g\", {\n        ref: this.arcGroupRef,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 107,\n          columnNumber: 11\n        }\n      }, paths), /*#__PURE__*/React.createElement(\"path\", {\n        className: \"clockHand\",\n        ref: this.clockHandRef,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 108,\n          columnNumber: 11\n        }\n      })));\n    }\n  }]);\n\n  return Clock;\n}(PureComponent);\n\nexport { Clock as default };","map":{"version":3,"sources":["/Users/linjinsheng/Desktop/ReactOriginStudy/第01章 理念篇/1.1 如何学习React源码/concurrent/src/Clock.js"],"names":["React","ConcurrentMode","unstable_ConcurrentMode","Component","Suspense","PureComponent","createRef","SPEED","Math","PI","FRAMES","Clock","faceRef","arcGroupRef","clockHandRef","frame","hitCounter","rotation","t0","Date","now","arcs","animate","td","push","lx","ly","tx","ty","length","forEach","i","r","cos","sin","bigArc","path","hue","min","colour","arcEl","current","children","setAttribute","shift","requestAnimationFrame","handleClick","e","stopPropagation","addEventListener","console","log","removeEventListener","cancelAnimationFrame","paths","Array"],"mappings":"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","sourcesContent":["import React from \"react\";\n\nconst {\n  unstable_ConcurrentMode: ConcurrentMode,\n  Component,\n  Suspense,\n  PureComponent,\n  createRef\n} = React;\n\nconst SPEED = 0.003 / Math.PI;\nconst FRAMES = 10;\n\nexport default class Clock extends PureComponent {\n  faceRef = createRef();\n  arcGroupRef = createRef();\n  clockHandRef = createRef();\n  frame = null;\n  hitCounter = 0;\n  rotation = 0;\n  t0 = Date.now();\n  arcs = [];\n\n  animate = () => {\n    const now = Date.now();\n    const td = now - this.t0;\n    this.rotation = (this.rotation + SPEED * td) % (2 * Math.PI);\n    this.t0 = now;\n\n    this.arcs.push({ rotation: this.rotation, td });\n\n    let lx, ly, tx, ty;\n    if (this.arcs.length > FRAMES) {\n      this.arcs.forEach(({ rotation, td }, i) => {\n        lx = tx;\n        ly = ty;\n        const r = 145;\n        tx = 155 + r * Math.cos(rotation);\n        ty = 155 + r * Math.sin(rotation);\n        const bigArc = SPEED * td < Math.PI ? \"0\" : \"1\";\n        const path = `M${tx} ${ty}A${r} ${r} 0 ${bigArc} 0 ${lx} ${ly}L155 155`;\n        const hue = 120 - Math.min(120, td / 4);\n        const colour = `hsl(${hue}, 100%, ${60 - i * (30 / FRAMES)}%)`;\n        if (i !== 0) {\n          const arcEl = this.arcGroupRef.current.children[i - 1];\n          arcEl.setAttribute(\"d\", path);\n          arcEl.setAttribute(\"fill\", colour);\n        }\n      });\n      this.clockHandRef.current.setAttribute(\"d\", `M155 155L${tx} ${ty}`);\n      this.arcs.shift();\n    }\n\n    if (this.hitCounter > 0) {\n      this.faceRef.current.setAttribute(\n        \"fill\",\n        `hsla(0, 0%, ${this.hitCounter}%, 0.95)`\n      );\n      this.hitCounter -= 1;\n    } else {\n      this.hitCounter = 0;\n      this.faceRef.current.setAttribute(\"fill\", \"hsla(0, 0%, 5%, 0.95)\");\n    }\n\n    this.frame = requestAnimationFrame(this.animate);\n  };\n\n  componentDidMount() {\n    this.frame = requestAnimationFrame(this.animate);\n    if (this.faceRef.current) {\n      this.faceRef.current.addEventListener(\"click\", this.handleClick);\n    }\n  }\n\n  componentDidUpdate() {\n    console.log(\"componentDidUpdate()\", this.faceRef.current);\n  }\n\n  componentWillUnmount() {\n    this.faceRef.current.removeEventListener(\"click\", this.handleClick);\n    if (this.frame) {\n      cancelAnimationFrame(this.frame);\n    }\n  }\n\n  handleClick = e => {\n    e.stopPropagation();\n    this.hitCounter = 50;\n  };\n\n  render() {\n    const paths = new Array(FRAMES);\n    for (let i = 0; i < FRAMES; i++) {\n      paths.push(<path className=\"arcHand\" key={i} />);\n    }\n    return (\n      <div className=\"stutterer\">\n        <svg height=\"310\" width=\"310\">\n          <circle\n            className=\"clockFace\"\n            onClick={this.handleClick}\n            cx={155}\n            cy={155}\n            r={150}\n            ref={this.faceRef}\n          />\n          <g ref={this.arcGroupRef}>{paths}</g>\n          <path className=\"clockHand\" ref={this.clockHandRef} />\n        </svg>\n      </div>\n    );\n  }\n}\n"]},"metadata":{},"sourceType":"module"}